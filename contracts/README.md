# Hedera Stable Coin Smart Contracts

## Overview

This project aims to host smart contracts that will manage Hedera stable coin. This contracts are based on an hybrid model which uses HTS and solidity smart contracts, bringing the best of the 2 worlds.
The architecture of the contracts consists of the following:

 - `HederaERC20`: Stable coin contract.
 - `HederaERC1967Proxy`: Extends OpenZeppelin implementation of an upgradeable proxy.
 - `TokenOwner`: Token owner contract
 - `Functionality extension contracts`: Several contracts implementing functionalities that can be included in stable coin contract.

All these contracts are accompanied by other small contracts, together with their interfaces, in which part of the functionality has been extracted in order to make it available for some of the previous contracts.

### Content

These are the contents you can find in this project:

 - `contracts`: The folder containing solidity files for the contracts. Inside this folder you can also find hts-precompile and extensions folders. The first one contains both `HederaResponseCodes` contract and `HederaTokenService` contract, next to the interface of the latter. These all contracts have not been developed by ioBuilders, but by the Hedera engineering team, and this is the reason why these contracts are located in a self folder. The second one consists of those contracts that offer contract specific functionality that can be added to stable coin contracts. Finally, contracts existing in root folder constitute stable coin base functionality.
 - `scripts`: This folder contains typescript files with the funcionality needed to execute smart contracts tests, so the deployment of the contracts and the interaction with them is made possible through these files.
 - `test`: Contains previously mentioned typescript tests files.
 - `typechain-types`: The most important thing in this folder are contract factories used not only for testing, but also for any other project importing this. The content of this folder is autogenerated by `hardhat-abi-exporter` plugin whenever the user compiles the contracts.
 - `.solhint.json`: Solhint tool configuration file for linting solidity code.
 - `hardhat.config.ts`: hardhat configuration file.
 - `package.json`: Node project configuration file.
 - `prettier.config.js`: Several languages code formatter configuration file.
 - `README.md`
 - `slither.config.json`: Slither configuration file.
 - `slither.report.json`: Slither report file.
 - `tsconfig.json`: TypeScript configuration file.

## Building

### Pre-requirements

You must have installed

- [node (version 16)](https://nodejs.org/en/about/)
- [npm](https://www.npmjs.com/)

### Steps

From root of the project workspace:

1. Execute `cd contracts`. This will put you in the contracts folder.
2. Run `npm install`. This will create and populate `node_modules`.

To compile the contracts, you can choose one of the following two alternatives:

- Run `npm run compile`. This will compile all contracts which have been changed since last compilation process.
- Run `npm run compile:fore`. This will compile all contracts although they have not been modified since last compilation process.

## Testing

#### Configuration

As the life cycle of contracts is controlled by hardhat, so both the compilation and testing processes are performed using hardhat, you must configure the accounts that will be used by the tests in the `hardhat.config.ts` file.

There are tests that only need one account to be executed, but others need two, so depending on the test file you are going to execute maybe one account configuration will be enough, but if you are going to execute all test files or a file test that needs two accounts you must configure both. We recommend this last option.

The part of the `hardhat.config.ts` file where the accounts to be configured are located is as follows:

```hardhat.config.ts
    testnet: {
        accounts: [
            // An array of predefined Externally Owned Accounts
            {
                account: "[include your account]",
                privateKey:"[include your private key]",
                publicKey:"[include your public key]",
                isED25519Type: true
            },
            {           
                account: "[include your account2]",
                privateKey:"[include your private key2]",
                publicKey:"[include your public key2]",
                isED25519Type: true
            },
        ],
    }
```

Above accounts configuration behaves to testnet, so another accounts configuration fragment for previewnet must be configured to execute test in this network.

To execute all tests, what will be explained in [Run](Run) section, you must take into account that both accounts, in whatever network, must have a minimum balance of HBAR. Currently, the firs account must have around 750 HBAR while the second one does not need more than 50 HBAR. These amounts could change in the future due to the price of the HBAR.

#### Run

There are several ways to execute tests using the scripts present in the `package.json` file:

 - Executing all the tests using the configuration present in hardhat configuration file. This way, tests are executed in the network configured by existing `defaultNetwork` property, so accounts associated to this network in the configuration file can be used:
```shell
npm test
```
 - Executing all the tests in the indicated network:
```shell
npm test:testnet
```

In the same way, you can execute only one test:
 - In the network present as `defaultNetwork` in hadhat configuration file:
```shell
npm test:mintable
```

 - In the specified network:
```shell
npm test:previewnet:mintable
```

The following tests files exist, so they can all be executed at the same time as explained first, or independently, as explained last:

```tests files
    burnable.ts
    erc20.ts
    mintable.ts
    pausable.ts
    rescatable.ts
    supplieradmin.ts
    wipeable.ts
```

All tests can be executed both in testnet and in previewnet with the appropiate command, as explained before, as long as you haved configured needed accounts in selected network through `hardhat.config.ts` file.

## Build

In order to other projects can use the contracts existing in this project we must build it using the following command:
```shell
npm run build
```

This will generate a `build` folder that contains the `typechain-types` folder. This last folder contains contracts wrappers that allows us to access contracts abi importing the wrappers as shown below:

```code
import { HederaERC20__factory } from 'hedera-stable-coin-contracts/typechain-types';
```

## Documentation

Documentation files of all contracts, in markdown format, can be generated using the following command:
```shell
npm run doc
```

Generated files will be located in project `docs` folder.

## Other Scripts

in addition to the compilation, build, test and documentation scripts we have already talked about, there are other scripts configured in `package.json` file:

Checks the contracts size in KiB.
```shell
npm run size
```

Lints Solidity code.
```shell
npm run lint:sol
```

Lints TypeScript code.
```shell
npm run lint:ts
```

Launches slither security report.
```shell
npm run security
```
